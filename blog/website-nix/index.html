<!doctype html><html lang=en><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://www.praguevara.dev/ name=base><title>praguevara • How I build my website</title><link href="https://www.praguevara.dev/inter_subset_en.css?h=d8cf4ad058d6c3a4015b" rel=stylesheet><link href="https://www.praguevara.dev/main.css?h=2e02623b98889ce02fac" rel=stylesheet><meta content="light dark" name=color-scheme><meta content="praguevara's personal site" name=description><meta content="praguevara's personal site" property=og:description><meta content="index, nofollow" name=robots><meta content="How I build my website" property=og:title><meta content=article property=og:type><meta content=en_GB property=og:locale><meta content=https://www.praguevara.dev/blog/website-nix/ property=og:url><meta content=praguevara property=og:site_name><meta content="default-src 'self';font-src 'self' data:;img-src 'self' https://* data:;media-src 'self';style-src 'self';frame-src player.vimeo.com https://www.youtube-nocookie.com;connect-src 'self' *.umami.dev analytics.eu.umami.is;script-src 'self' analytics.eu.umami.is 'self'" http-equiv=Content-Security-Policy><noscript><link href=https://www.praguevara.dev/no_js.css rel=stylesheet></noscript><script src=https://www.praguevara.dev/js/initializeTheme.min.js></script><script defer src=https://www.praguevara.dev/js/themeSwitcher.min.js></script><script async data-do-not-track=true data-website-id=0c7e37b7-63ab-4bb1-8569-f3539cca7a85 defer src=https://analytics.eu.umami.is/script.js></script><body><header><nav class=navbar><div class=nav-title><a class=home-title href=https://www.praguevara.dev>praguevara</a></div><div class=nav-navs><ul><li><a class="nav-links no-hover-padding" href=https://www.praguevara.dev/blog/> blog </a><li><a class="nav-links no-hover-padding" href=https://www.praguevara.dev/cv> cv </a><li><a class="nav-links no-hover-padding" href=https://www.praguevara.dev/about> about </a><li><a class="nav-links no-hover-padding" href=https://www.praguevara.dev/archive/> archive </a><li class="theme-switcher-wrapper js"><div aria-label="Toggle dark mode" title="Toggle dark/light mode" aria-pressed=false class=theme-switcher role=button tabindex=0></div><div aria-label="Reset mode to default" class="theme-resetter arrow" title="Reset mode to default" aria-hidden=true role=button tabindex=0></div></ul></div></nav></header><div class=content><main><article><h1 class=article-title>How I build my website</h1><ul class=meta><li>1st Oct 2024</li> • <li title="635 words">4 min read</ul><section class=body><p>My website is made with <a href=https://www.getzola.org/>Zola</a> and built with a Nix Flake. I also build a PDF version of my <a href=https://www.praguevara.dev/cv/>CV</a> with <a href=https://pandoc.org/>Pandoc</a> automatically. It's hosted in GitHub pages, and built with a GH action.<p>I've taken the Nix pill, and while it's sometimes hard to swallow, and the UX isn't great, the benefits are pretty amazing. It allows for everything to be declarative, so the builds are always reproducible.<p>Since it's a standard Zola project - which uses the <a href=https://github.com/welpo/tabi>tabi</a> theme, it has <code>content</code>, <code>static</code>, <code>templates</code>, etc... directories, which the command <code>zola build</code> uses to build a website and put it in a <code>public</code> directory.<p>This is the <code>flake.nix</code> file. A flake, among other things, declares inputs and locks them, so you get reproducibility in your builds.<pre class="language-nix z-code" data-lang=nix><code class=language-nix data-lang=nix><span class="z-source z-nix"><span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
</span><span class="z-source z-nix">  <span class="z-entity z-other z-attribute-name z-multipart z-nix">description</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">"</span>Personal website for praguevara<span class="z-punctuation z-definition z-string z-double z-end z-nix">"</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">
</span><span class="z-source z-nix">  <span class="z-entity z-other z-attribute-name z-multipart z-nix">inputs</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
</span><span class="z-source z-nix">    <span class="z-entity z-other z-attribute-name z-multipart z-nix">nixpkgs</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">url</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">"</span>github:NixOS/nixpkgs/nixos-24.05<span class="z-punctuation z-definition z-string z-double z-end z-nix">"</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">    <span class="z-entity z-other z-attribute-name z-multipart z-nix">utils</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">url</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">"</span>github:numtide/flake-utils<span class="z-punctuation z-definition z-string z-double z-end z-nix">"</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">    <span class="z-entity z-other z-attribute-name z-multipart z-nix">theme</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
</span><span class="z-source z-nix">      <span class="z-entity z-other z-attribute-name z-multipart z-nix">url</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">"</span>github:welpo/tabi<span class="z-punctuation z-definition z-string z-double z-end z-nix">"</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">      <span class="z-entity z-other z-attribute-name z-multipart z-nix">flake</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-constant z-language z-nix">false</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">    <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">  <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">
</span><span class="z-source z-nix">  <span class="z-entity z-other z-attribute-name z-multipart z-nix">outputs</span> <span class="z-keyword z-operator z-bind z-nix">=</span>
</span><span class="z-source z-nix">    <span class="z-variable z-parameter z-function z-4 z-nix">inputs</span>@<span class="z-punctuation z-definition z-entity z-function z-2 z-nix">{</span>
</span><span class="z-source z-nix">      <span class="z-variable z-parameter z-function z-1 z-nix">self</span><span class="z-keyword z-operator z-nix">,</span>
</span><span class="z-source z-nix">      <span class="z-variable z-parameter z-function z-1 z-nix">nixpkgs</span><span class="z-keyword z-operator z-nix">,</span>
</span><span class="z-source z-nix">      <span class="z-variable z-parameter z-function z-1 z-nix">utils</span><span class="z-keyword z-operator z-nix">,</span>
</span><span class="z-source z-nix">      <span class="z-keyword z-operator z-nix">...
</span></span><span class="z-source z-nix"><span class="z-keyword z-operator z-nix">    </span><span class="z-punctuation z-definition z-entity z-function z-nix">}</span><span class="z-punctuation z-definition z-function z-nix">:</span>
</span><span class="z-source z-nix">    <span class="z-variable z-parameter z-name z-nix">utils</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">lib</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">eachSystem</span>
</span><span class="z-source z-nix">      <span class="z-punctuation z-definition z-list z-nix">[</span>
</span><span class="z-source z-nix">        <span class="z-variable z-parameter z-name z-nix">utils</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">lib</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">system</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">x86_64-darwin</span>
</span><span class="z-source z-nix">        <span class="z-variable z-parameter z-name z-nix">utils</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">lib</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">system</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">x86_64-linux</span>
</span><span class="z-source z-nix">        <span class="z-variable z-parameter z-name z-nix">utils</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">lib</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">system</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">aarch64-darwin</span>
</span><span class="z-source z-nix">        <span class="z-variable z-parameter z-name z-nix">utils</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">lib</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">system</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">aarch64-linux</span>
</span><span class="z-source z-nix">      <span class="z-punctuation z-definition z-list z-nix">]</span>
</span><span class="z-source z-nix">      <span class="z-punctuation z-definition z-expression z-nix">(</span>
</span><span class="z-source z-nix">        <span class="z-variable z-parameter z-function z-4 z-nix">system</span><span class="z-punctuation z-definition z-function z-nix">:</span>
</span><span class="z-source z-nix">        <span class="z-keyword z-other z-nix">let</span>
</span><span class="z-source z-nix">          <span class="z-entity z-other z-attribute-name z-multipart z-nix">pkgs</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-support z-function z-nix">import</span> <span class="z-variable z-parameter z-name z-nix">nixpkgs</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
</span><span class="z-source z-nix">            <span class="z-keyword z-other z-inherit z-nix">inherit</span> <span class="z-entity z-other z-attribute-name z-single z-nix">system</span><span class="z-punctuation z-terminator z-inherit z-nix">;</span>
</span><span class="z-source z-nix">          <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">        <span class="z-keyword z-other z-nix">in</span>
</span><span class="z-source z-nix">        <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
</span><span class="z-source z-nix">          <span class="z-entity z-other z-attribute-name z-multipart z-nix">packages</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">website</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">pkgs</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">stdenv</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">mkDerivation</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
</span><span class="z-source z-nix">            <span class="z-entity z-other z-attribute-name z-multipart z-nix">name</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">"</span>website<span class="z-punctuation z-definition z-string z-double z-end z-nix">"</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">            <span class="z-entity z-other z-attribute-name z-multipart z-nix">src</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">self</span><span class="z-punctuation z-terminator z-bind z-nix">;</span> <span class="z-comment z-line z-number-sign z-nix"># 'self' refers to the flake's source</span>
</span><span class="z-source z-nix">
</span><span class="z-source z-nix">            <span class="z-entity z-other z-attribute-name z-multipart z-nix">buildInputs</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-list z-nix">[</span>
</span><span class="z-source z-nix">              <span class="z-variable z-parameter z-name z-nix">pkgs</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">nodePackages</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">prettier</span>
</span><span class="z-source z-nix">              <span class="z-variable z-parameter z-name z-nix">pkgs</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">pandoc</span>
</span><span class="z-source z-nix">              <span class="z-variable z-parameter z-name z-nix">pkgs</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">zola</span>
</span><span class="z-source z-nix">              <span class="z-punctuation z-definition z-expression z-nix">(</span><span class="z-variable z-parameter z-name z-nix">pkgs</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">texlive</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">combine</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
</span><span class="z-source z-nix">                <span class="z-keyword z-other z-inherit z-nix">inherit</span> <span class="z-punctuation z-section z-function z-arguments z-nix">(</span><span class="z-variable z-parameter z-name z-nix">pkgs</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">texlive</span><span class="z-punctuation z-section z-function z-arguments z-nix">)</span>
</span><span class="z-source z-nix">                  <span class="z-entity z-other z-attribute-name z-single z-nix">scheme-basic</span>
</span><span class="z-source z-nix">                  <span class="z-entity z-other z-attribute-name z-single z-nix">etoolbox</span>
</span><span class="z-source z-nix">                  <span class="z-entity z-other z-attribute-name z-single z-nix">enumitem</span>
</span><span class="z-source z-nix">                  <span class="z-entity z-other z-attribute-name z-single z-nix">underscore</span>
</span><span class="z-source z-nix">                  <span class="z-entity z-other z-attribute-name z-single z-nix">parskip</span>
</span><span class="z-source z-nix">                  <span class="z-entity z-other z-attribute-name z-single z-nix">xcolor</span>
</span><span class="z-source z-nix">                  <span class="z-entity z-other z-attribute-name z-single z-nix">sectsty</span>
</span><span class="z-source z-nix">                  <span class="z-punctuation z-terminator z-inherit z-nix">;</span>
</span><span class="z-source z-nix">              <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-definition z-expression z-nix">)</span>
</span><span class="z-source z-nix">            <span class="z-punctuation z-definition z-list z-nix">]</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">
</span><span class="z-source z-nix">            <span class="z-entity z-other z-attribute-name z-multipart z-nix">buildPhase</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-other z-nix"><span class="z-punctuation z-definition z-string z-other z-start z-nix">''</span>
</span></span><span class="z-source z-nix"><span class="z-string z-quoted z-other z-nix">              # Generate the PDF from cv.md
</span></span><span class="z-source z-nix"><span class="z-string z-quoted z-other z-nix">              pandoc <span class="z-markup z-italic"><span class="z-punctuation z-section z-embedded z-begin z-nix">${</span><span class="z-variable z-parameter z-name z-nix">self</span><span class="z-punctuation z-section z-embedded z-end z-nix">}</span></span>/content/cv/cv.md -o static/pablo_ramon_guevara_cv.pdf --template <span class="z-markup z-italic"><span class="z-punctuation z-section z-embedded z-begin z-nix">${</span><span class="z-variable z-parameter z-name z-nix">self</span><span class="z-punctuation z-section z-embedded z-end z-nix">}</span></span>/jb2resume.latex
</span></span><span class="z-source z-nix"><span class="z-string z-quoted z-other z-nix">
</span></span><span class="z-source z-nix"><span class="z-string z-quoted z-other z-nix">              mkdir -p themes
</span></span><span class="z-source z-nix"><span class="z-string z-quoted z-other z-nix">              ln -s <span class="z-markup z-italic"><span class="z-punctuation z-section z-embedded z-begin z-nix">${</span><span class="z-variable z-parameter z-name z-nix">inputs</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">theme</span><span class="z-punctuation z-section z-embedded z-end z-nix">}</span></span> themes/tabi
</span></span><span class="z-source z-nix"><span class="z-string z-quoted z-other z-nix">
</span></span><span class="z-source z-nix"><span class="z-string z-quoted z-other z-nix">              # Copy config.toml directly from src
</span></span><span class="z-source z-nix"><span class="z-string z-quoted z-other z-nix">              cp <span class="z-markup z-italic"><span class="z-punctuation z-section z-embedded z-begin z-nix">${</span><span class="z-variable z-parameter z-name z-nix">self</span><span class="z-punctuation z-section z-embedded z-end z-nix">}</span></span>/config.toml config.toml
</span></span><span class="z-source z-nix"><span class="z-string z-quoted z-other z-nix">
</span></span><span class="z-source z-nix"><span class="z-string z-quoted z-other z-nix">              cp -r <span class="z-markup z-italic"><span class="z-punctuation z-section z-embedded z-begin z-nix">${</span><span class="z-variable z-parameter z-name z-nix">self</span><span class="z-punctuation z-section z-embedded z-end z-nix">}</span></span>/content/ content/
</span></span><span class="z-source z-nix"><span class="z-string z-quoted z-other z-nix">              cp -r <span class="z-markup z-italic"><span class="z-punctuation z-section z-embedded z-begin z-nix">${</span><span class="z-variable z-parameter z-name z-nix">self</span><span class="z-punctuation z-section z-embedded z-end z-nix">}</span></span>/templates/ templates/
</span></span><span class="z-source z-nix"><span class="z-string z-quoted z-other z-nix">              cp -r <span class="z-markup z-italic"><span class="z-punctuation z-section z-embedded z-begin z-nix">${</span><span class="z-variable z-parameter z-name z-nix">self</span><span class="z-punctuation z-section z-embedded z-end z-nix">}</span></span>/static/ static/
</span></span><span class="z-source z-nix"><span class="z-string z-quoted z-other z-nix">
</span></span><span class="z-source z-nix"><span class="z-string z-quoted z-other z-nix">              zola build
</span></span><span class="z-source z-nix"><span class="z-string z-quoted z-other z-nix">              prettier -w public '!**/*.{js,css}'
</span></span><span class="z-source z-nix"><span class="z-string z-quoted z-other z-nix">            <span class="z-punctuation z-definition z-string z-other z-end z-nix">''</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">
</span><span class="z-source z-nix">            <span class="z-entity z-other z-attribute-name z-multipart z-nix">installPhase</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-other z-nix"><span class="z-punctuation z-definition z-string z-other z-start z-nix">''</span>
</span></span><span class="z-source z-nix"><span class="z-string z-quoted z-other z-nix">              mkdir -p $out
</span></span><span class="z-source z-nix"><span class="z-string z-quoted z-other z-nix">              cp -r public/. $out/
</span></span><span class="z-source z-nix"><span class="z-string z-quoted z-other z-nix">            <span class="z-punctuation z-definition z-string z-other z-end z-nix">''</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">          <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">
</span><span class="z-source z-nix">          <span class="z-entity z-other z-attribute-name z-multipart z-nix">defaultPackage</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">self</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">packages</span><span class="z-keyword z-operator z-nix">.</span><span class="z-markup z-italic"><span class="z-punctuation z-section z-embedded z-begin z-nix">${</span><span class="z-variable z-parameter z-name z-nix">system</span><span class="z-punctuation z-section z-embedded z-end z-nix">}</span></span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">website</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">
</span><span class="z-source z-nix">          <span class="z-entity z-other z-attribute-name z-multipart z-nix">apps</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">default</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">utils</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">lib</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">mkApp</span> <span class="z-punctuation z-definition z-attrset z-nix">{</span> <span class="z-entity z-other z-attribute-name z-multipart z-nix">drv</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">self</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">packages</span><span class="z-keyword z-operator z-nix">.</span><span class="z-markup z-italic"><span class="z-punctuation z-section z-embedded z-begin z-nix">${</span><span class="z-variable z-parameter z-name z-nix">system</span><span class="z-punctuation z-section z-embedded z-end z-nix">}</span></span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">website</span><span class="z-punctuation z-terminator z-bind z-nix">;</span> <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">
</span><span class="z-source z-nix">          <span class="z-entity z-other z-attribute-name z-multipart z-nix">devShell</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">pkgs</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">mkShell</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
</span><span class="z-source z-nix">            <span class="z-entity z-other z-attribute-name z-multipart z-nix">buildInputs</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-list z-nix">[</span>
</span><span class="z-source z-nix">              <span class="z-variable z-parameter z-name z-nix">pkgs</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">nixpkgs-fmt</span>
</span><span class="z-source z-nix">              <span class="z-variable z-parameter z-name z-nix">pkgs</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">zola</span>
</span><span class="z-source z-nix">              <span class="z-variable z-parameter z-name z-nix">pkgs</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">pandoc</span>
</span><span class="z-source z-nix">              <span class="z-variable z-parameter z-name z-nix">pkgs</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">nodePackages</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">prettier</span>
</span><span class="z-source z-nix">            <span class="z-punctuation z-definition z-list z-nix">]</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">
</span><span class="z-source z-nix">            <span class="z-entity z-other z-attribute-name z-multipart z-nix">shellHook</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-other z-nix"><span class="z-punctuation z-definition z-string z-other z-start z-nix">''</span>
</span></span><span class="z-source z-nix"><span class="z-string z-quoted z-other z-nix">              mkdir -p themes
</span></span><span class="z-source z-nix"><span class="z-string z-quoted z-other z-nix">              ln -s <span class="z-markup z-italic"><span class="z-punctuation z-section z-embedded z-begin z-nix">${</span><span class="z-variable z-parameter z-name z-nix">inputs</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">theme</span><span class="z-punctuation z-section z-embedded z-end z-nix">}</span></span> themes/tabi
</span></span><span class="z-source z-nix"><span class="z-string z-quoted z-other z-nix">            <span class="z-punctuation z-definition z-string z-other z-end z-nix">''</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">          <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">        <span class="z-punctuation z-definition z-attrset z-nix">}</span>
</span><span class="z-source z-nix">      <span class="z-punctuation z-definition z-expression z-nix">)</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix"><span class="z-punctuation z-definition z-attrset z-nix">}</span>
</span><span class="z-source z-nix">
</span></code></pre><p>The relevant sections of the flake are:<ul><li><p><strong>Inputs</strong>: the whole nixpkgs version 24.05, from which I grab prettier, pandoc, zola and texlive. I also use <code>flake-utils</code>, and a custom input called <code>theme</code>, which points to the <code>tabi</code> repository even though it's not a flake.</p><li><p><strong>Derivation</strong>: the part that's in between curly brackets after <code>mkDerivation</code>. In the buildInputs I define what packages are necessary to build the site. Then, the magic happens in the <code>buildPhase</code>, where I generate the CV using pandoc, copy the relevant files and directories and build the site. After it's built, the <code>installPhase</code> copies the <code>public</code> directory to the <code>$out</code> variable, which points to the output of the derivation.</p><li><p><strong>Development shell</strong>: this section declares what packages are available and what actions are run when you run the <code>nix develop</code> command. This allows me to run <code>zola serve</code> to test changes. I also use <a href=https://direnv.net/>direnv</a> with <code>use flake;</code> in my <code>.envrc</code>, which runs the command automatically when I cd into it.</p></ul><p>When I run a <code>git push</code>, the following GitHub action is triggered:<pre class="language-yaml z-code" data-lang=yaml><code class=language-yaml data-lang=yaml><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Build and Deploy to GitHub Pages</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml"><span class="z-constant z-language z-boolean z-yaml">on</span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">push</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">branches</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml">master</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">workflow_dispatch</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">jobs</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">  <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">build-and-deploy</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">runs-on</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">ubuntu-latest</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml">    <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">steps</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Checkout Repository</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">uses</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">actions/checkout@v4</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Install Nix</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">uses</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">cachix/install-nix-action@v27</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">with</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">          <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">github_access_token</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">${{ secrets.GITHUB_TOKEN }}</span>
</span><span class="z-source z-yaml">          <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">nix_path</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">nixpkgs=channel:nixos-24.05</span>
</span><span class="z-source z-yaml">          <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">extra_nix_config</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-keyword z-control z-flow z-block-scalar z-literal z-yaml">|</span>
</span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">            trusted-public-keys = hydra.iohk.io:f/Ea+s+dFdN+3Y/G+FDgSq+a5NEWhJGzdjvKNGv0/EQ= cache.nixos.org-1:6NCHdD59X431o0gWypbMrAURkbJ16ZPMQFGspcDShjY=
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">            substituters = https://hydra.iohk.io https://cache.nixos.org/
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml">
</span></span><span class="z-source z-yaml"><span class="z-string z-unquoted z-block z-yaml"></span>      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Build Site with Nix</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">run</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">nix build .#website</span>
</span><span class="z-source z-yaml">
</span><span class="z-source z-yaml">      <span class="z-punctuation z-definition z-block z-sequence z-item z-yaml">-</span> <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">name</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">Deploy to GitHub Pages</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">uses</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">peaceiris/actions-gh-pages@v3</span>
</span><span class="z-source z-yaml">        <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">with</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span>
</span><span class="z-source z-yaml">          <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">github_token</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">${{ secrets.GITHUB_TOKEN }}</span>
</span><span class="z-source z-yaml">          <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">publish_dir</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">./result</span>
</span><span class="z-source z-yaml">          <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">publish_branch</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-string z-unquoted z-plain z-out z-yaml">gh-pages</span>
</span><span class="z-source z-yaml">          <span class="z-string z-unquoted z-plain z-out z-yaml"><span class="z-entity z-name z-tag z-yaml">force_orphan</span></span><span class="z-punctuation z-separator z-key-value z-mapping z-yaml">:</span> <span class="z-constant z-language z-boolean z-yaml">true</span>
</span><span class="z-source z-yaml">
</span></code></pre><p>It takes 2 minutes to run.<p>Nix really shines here. Install, run <code>nix build .#website</code> and deploy. You always use the same command, regardless of the complexity of the build process.<p>By the way, I took inspiration from this <a href=https://www.chrisportela.com/posts/this-site-is-a-flake/>post</a> to create my flake originally. You should give it a look (it's quite short).</section><nav class="full-width article-navigation"><div><a aria-describedby=left_title aria-label=Next href=https://www.praguevara.dev/blog/japanizer/><span class=arrow>←</span> Next</a><p aria-hidden=true id=left_title>I built a ChatGPT wrapper to phonetically transcribe text into Japanese</div><div><a aria-describedby=right_title aria-label=Prev href=https://www.praguevara.dev/blog/emoji-graffiti/>Prev <span class=arrow>→</span></a><p aria-hidden=true id=right_title>Emoji Graffiti</div></nav></article></main><span class=hidden id=copy-success> Copied! </span><span class=hidden id=copy-init> Copy code to clipboard </span><script defer src=https://www.praguevara.dev/js/copyCodeToClipboard.min.js></script></div><footer><section><nav class="socials nav-navs"><ul><li><a class="nav-links no-hover-padding social" rel=" me" href=https://github.com/praguevara/> <img alt=github loading=lazy src=https://www.praguevara.dev/social_icons/github.svg title=github> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=https://x.com/praguevara> <img alt=x loading=lazy src=https://www.praguevara.dev/social_icons/x.svg title=x> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=https://www.linkedin.com/in/pablo-ram%C3%B3n-guevara-498283165/> <img alt=linkedin loading=lazy src=https://www.praguevara.dev/social_icons/linkedin.svg title=linkedin> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=/pgp.txt> <img alt=pgp loading=lazy src=https://www.praguevara.dev/social_icons/key.svg title=pgp> </a></ul></nav><nav class=nav-navs></nav><div class=credits><small> Powered by <a href=https://www.getzola.org>Zola</a> & <a href=https://github.com/welpo/tabi>tabi</a> </small></div></section></footer>